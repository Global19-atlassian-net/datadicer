"use strict";angular.module("ngramApp",["ui.bootstrap","ngAnimate","ngAria","ui.router","ngSanitize","angular.filter"]).config(["ngramAppConfig",function(a){a.trackingEnabled=!0,a.serviceEngine="solr",a.serviceQueryUrl="http://solrserver:8983/solr/core1/select?wt=json&indent=true&json.wrf=?",a.serviceDownloadCallback=function(b){try{var c=a.serviceQueryUrl.split("?")[0];c+="?q="+(b.q?b.q:"*:*"),c+="&rows=1000&wt=csv&start=0",b.filters&&angular.isArray(b.filters)&&b.filters.forEach(function(a){c+="&fq="+a}),window.location.assign(c)}catch(d){console.warn(d)}}}]),angular.module("ngramApp").filter("removeSpacesThenLowercase",function(){return function(a){var b=a.replace(/\s+/g,"");return b.toLowerCase()}}).filter("sortAndFilterTags",function(){return function(a,b){if(!b||b.length<1)return a;var c,d,e=[];for(d=0;d<a.length;d++)c=a[d],b.indexOf(c)===-1&&b.indexOf(c.name)===-1||e.push(c);var f={};return angular.isArray(b)||(b=[b]),b.forEach(function(a,b){f[a]=b}),e.length>0&&e[0].name&&e.sort(function(a,b){return f[a.name]>f[b.name]}),e}}).filter("trustedUrl",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]).filter("unsafe",["$sce",function(a){return a.trustAsHtml}]),angular.module("ngramApp").controller("MainCtrl",["debounce","ngramAppConfig","$scope","$compile","$stateParams","$http","$state","$timeout",function(a,b,c,d,e,f,g,h){c.gridConfig={collection:"bioactivity",schema:"bioactivity",facetFields:[{displayname:"Assay Type",name:"aidtype",allowZeros:!0},{displayname:"Activity",name:"actvty",allowZeros:!0}],stringFilterFields:[{name:"cmpdname",label:"Compound Name",placeholder:" filter by Compound Name ",minimum:2,suggestions:function(a){return f.get("//maps.googleapis.com/maps/api/geocode/json",{params:{address:a,sensor:!1}}).then(function(a){return a.data.results.map(function(a){return a.formatted_address})})}},{name:"aidname",label:"Assay Name",placeholder:" filter by Assay Name ",minimum:2,suggestions:["assay name 1","assay name 2","assay name 3"]},{name:"aidname",label:"Assay Name 2",placeholder:" filter by Assay Name ",minimum:2,suggestions:["assay name 4","assay name 5","assay name 6"]},{name:"cmpdname",label:"Compound Name",placeholder:" filter by Compound Name ",minimum:2,suggestions:"cmpdname"}],rangeFacetFields:{mw:{field:"mw",name:"Molecular Weight",unit:"Molecular Weight, Daltons ",xmin:1,xmax:20,xtickscale:100,width:.5*window.innerWidth>500?500:.5*window.innerWidth,height:100},acvalue:{field:"acvalue",name:"Activity Value ",unit:"Activity Value, μM",xmin:1,xmax:20,xtickscale:5,width:.5*window.innerWidth>500?500:.5*window.innerWidth,height:100}},colModel:[{name:"aid",label:"AID",tips:' if you would like to configure a tip for this header, please set "tips" property"',width:60,align:"right",sortable:!1},{name:"aidtype",label:"Assay Type",tips:' if you would like to configure a tip for this header, please set "tips" property"',sortable:!1,align:"right",search:!1},{name:"cmpdname",label:"Compound Name",tips:' if you would like to configure a tip for this header, please set "tips" property"',sortable:!1,search:!1,align:"right",formatter:function(a,b,c){return c&&c.cid?'<a  analytics-label="link_label" class="jqgrid-ng-scope"  target="_blank" title="Link"ng-href="//url/'+c.cid+'">'+a+"</a>":a}},{name:"actvty",label:"Activity",tips:"Activity",width:50,search:!1,align:"right",sortable:!0}],hideLastPager:!0,adjustGridWidthOnWindowsResize:!0,adjustGridWidthOnColumnChange:!1,showHideColumns:!0,headertitles:!1},"solr"===b.serviceEngine&&(c.gridConfig.rangeFacetFields=[{field:"mw",name:"Molecular Weight",unit:"Molecular Weight, Daltons ",xmin:1,xmax:200,xtickscale:10,width:.5*window.innerWidth>500?500:.5*window.innerWidth,height:100},{field:"acvalue",name:"Activity Value ",unit:"Activity Value, μM",xmin:1,xmax:100,xtickscale:1,width:.5*window.innerWidth>500?500:.5*window.innerWidth,height:100},{field:"aidmdate",name:"Modified Date",unit:"Modified Date",xmin:new Date(1996,1,1),xmax:new Date,xUnits:"undefined"!=typeof d3?d3.time.months:null,timeParser:"undefined"!=typeof d3?d3.time.format("%Y-%m-%dT%H:%M:%SZ").parse:null,width:.5*window.innerWidth>500?500:.5*window.innerWidth,height:100}],c.gridConfig.SolrBackEndConfigurations={facet:"on","facet.field":["aidtype","actvty"],"facet.limit":10,"facet.range":["{!ex=mw}mw","{!ex=acvalue}acvalue","{!ex=aidmdate}aidmdate"],"f.mw.facet.scale":1e3,"f.mw.facet.range.start":0,"f.mw.facet.range.end":2e6,"f.mw.facet.range.gap":1e4,"f.mw.facet.mincount":0,"f.aidmdate.facet.range.start":"NOW/YEAR-20YEARS","f.aidmdate.facet.range.end":"NOW","f.aidmdate.facet.range.gap":"+1MONTHS","f.acvalue.facet.range.start":0,"f.acvalue.facet.range.end":200,"f.acvalue.facet.range.gap":1,"f.acvalue.facet.mincount":0}),c.query={matching:""},c.filters=c.filters||{},c.rangeFilters=c.rangeFilters||{},g.is("/")?c.query.matching=e.matching:e.term&&(c.query.matching=e.term),c.startNewSearch=function(){g.go("/",{report:e.report})},c.performSearch=function(a){return""===c.query.matching?(g.transitionTo("/",{report:e.report},{location:!0,replace:!0,notify:!1}),c.$broadcast("gridtable.reload",{matching:""}),!1):(g.is("/")?e.matching&&e.matching===c.query.matching||g.transitionTo("view.table",{term:c.query.matching,report:e.report},{location:!0,replace:!0,notify:!0}):(g.is("view")||g.is("view.table"))&&g.go("view.table",{term:c.query.matching,report:e.report}),void h(function(){c.$broadcast("gridtable.reload"),c.$broadcast("cddinfo.reload")}))},c.performSearchDebounced=a(c.performSearch,600,!1),c.startOver=function(a){c.query.matching="",c.filters.resetAllFilters(),g.go("/",{report:e.report})},c.$on("gridtable.initialized",function(a,b){c.performSearch(a)}),c.$on("gridtable.columnUpdated",function(a,b){console.info(a,b)})}]),function(a){"function"==typeof define&&define.amd?define(["jquery","./jqdnr","./jqmodal"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){a.jgrid=a.jgrid||{},a.extend(a.jgrid,{showHideColumnMenu:{adjustGridWidth:!0,viewHideDlgColumnsAsDisabled:!1,allowHideInernalColumns:!1,shrink:!1,menuStyle:{"float":"left"},modifyMenuItem:function(b,c,d){return a.inArray(c.name,["rn","subgrid","cb"])>=0?void(d.allowHideInernalColumns||b.hide()):void(c.hidedlg&&(d.viewHideDlgColumnsAsDisabled?b.addClass("ui-state-disabled"):b.hide()))}}}),a.jgrid.extend({showHideColumnMenu:function(b){var c=a.extend(!0,{},a.jgrid.showHideColumnMenu,b),d=null!==a.ui&&"string"==typeof a.ui.version?/^([0-9]+)\.([0-9]+)\.([0-9]+)$/.exec(a.ui.version):[],e=null!==d&&4===d.length&&"1"===d[1]&&d[2]<11;return this.each(function(){var b=a(this),d=function(){a(this.grid.hDiv).find(".ui-jqgrid-labels").contextmenu(function(d){var f,g,h,i,j,k,l,m=b.jqGrid("getGridParam"),n=m.colModel,o=m.colNames,p=n.length,q=m.groupHeader,r={},s={},t=a('<ul class="ui-jqgrid-showHideColumnMenu"></ul>');for(f=0;f<p;f++)r[n[f].name]=f;if(q&&q.groupHeaders)for(i=0,k=q.groupHeaders.length;i<k;i++)for(l=q.groupHeaders[i],j=0;j<l.numberOfColumns;j++)f=r[l.startColumnName]+j,g=n[f],s[f]=a.isFunction(c.buildItemText)?c.buildItemText.call(b[0],{iCol:f,cm:g,cmName:g.name,colName:o[f],groupTitleText:l.titleText}):a.jgrid.stripHtml(l.titleText)+": "+a.jgrid.stripHtml(""===o[f]?g.name:o[f]);for(f=0;f<p;f++)void 0===s[f]&&(g=n[f],s[f]=a.isFunction(c.buildItemText)?c.buildItemText.call(b[0],{iCol:f,cm:g,cmName:g.name,colName:o[f],groupTitleText:null}):a.jgrid.stripHtml(o[f]));for(f=0;f<p;f++)g=n[f],h=a("<li></li>").data("iCol",f).html(s[f]),c.modifyMenuItem.call(b[0],h,g,c),h.prepend(g.hidden?c.checkboxUnChecked:c.checkboxChecked),e&&h.wrapInner("<a></a>"),h.appendTo(t);return t.css(c.menuStyle),a("ul.ui-jqgrid-showHideColumnMenu").menu("destroy").remove(),t.appendTo("body").menu({select:function(d,e){var f=parseInt(e.item.data("iCol"),10),g=e.item.find(c.checkboxSelector),h=n[f],i=c.isChecked.call(b[0],g,d,h);!isNaN(f)&&f>=0&&h&&g.length>0&&(i?(c.toUnCheck.call(b[0],g,d,h),b.jqGrid("hideCol",h.name)):(c.toCheck.call(b[0],g,d,h),b.jqGrid("showCol",h.name)),c.adjustGridWidth||b.trigger("resize"),a(this).parent().css("zoom",1),t.menu("focus",d,e.item))},create:function(){var a=t.height(),b=window.innerHeight||document.documentElement.clientHeight;a>b&&t.height(b).css("overflow-y","scroll")}}).mouseleave(function(){a(this).menu("destroy").remove()}).position({of:a(d.target),my:"left top",at:"right center",collision:"flipfit flipfit"}),!1})};c=a.extend(!0,"fontAwesome"===this.p.iconSet||"fontAwesome"===c.iconSet?{checkboxChecked:'<i class="fa fa-check-square-o fa-fw fa-lg"></i>&nbsp;',checkboxUnChecked:'<i class="fa fa-square-o fa-fw fa-lg"></i>&nbsp;',checkboxSelector:"i.fa",isChecked:function(a){return a.hasClass("fa-check-square-o")},toCheck:function(a){a.removeClass("fa-square-o").addClass("fa-check-square-o")},toUnCheck:function(a){a.removeClass("fa-check-square-o").addClass("fa-square-o")}}:{checkboxChecked:'<input disabled="disabled" checked="checked" type="checkbox"/>',checkboxUnChecked:'<input disabled="disabled" type="checkbox"/>',checkboxSelector:"input[type=checkbox]",isChecked:function(a){return a.is(":checked")},toCheck:function(a){a.prop("checked",!0)},toUnCheck:function(a){a.prop("checked",!1)}},c),d.call(this),b.bind("jqGridAfterSetGroupHeaders",function(){d.call(this)})})}})}),function(a){a.fn.replaceTagName=function(b){for(var c=[],d=this.length;d--;){for(var e=document.createElement(b),f=this[d],g=f.attributes,h=g.length-1;h>=0;h--){var i=g[h];e.setAttribute(i.name,i.value)}e.innerHTML=f.innerHTML,a(f).after(e).remove(),c[d]=e}return a(c)}}(window.jQuery),angular.module("ngramApp").directive("advancedOptions",function(){var a=function(a,b,c,d){a.$on("optnpanel.reset",function(a,b){}),a.$watch("panel.open",function(a){a?setTimeout(function(){$(b).find(".filters-close").focus()},0):setTimeout(function(){$(b).find(".filters-open").focus()},0)})},b=function(a,b,c,d){var e=c.getDriver(null,a),f={advOpts:{open:!1,downloadBtn:{hidden:!1,css:"btn-default pull-right",tips:"Download (10k limit)",tipsPlacement:"top",onClick:function(){return e.download(a.selarrrow)}}}};a.config=a.config||f;try{a.panel={open:a.config.advOpts.open},a.config.advOpts.downloadBtn.onClick=a.config.advOpts.downloadBtn.onClick||f.advOpts.downloadBtn.onClick}catch(g){}a.rangeFilters=a.rangeFilters||{},a.filters=a.filters||{},a.filters.filtersCount=a.filters.filtersCount||function(b){var c,d=angular.extend({ignorePreDefinedFilter:!0},b),e=0,f=function(a){!a.selected||a.not4Counting&&d.ignorePreDefinedFilter||e++};if(a.filters)for(c in a.filters)a.filters.hasOwnProperty(c)&&Array.isArray(a.filters[c])?a.filters[c].forEach(f):a.filters.hasOwnProperty(c)&&angular.isString(a.filters[c])&&a.filters[c].length>0&&e++;if(a.rangeFilters)for(c in a.rangeFilters)a.rangeFilters.hasOwnProperty(c)&&Array.isArray(a.rangeFilters[c])&&a.rangeFilters[c].length>0&&e++;return e},a.filters.resetAllFilters=a.filters.resetAllFilters||function(b){var c=angular.extend({doSearch:!1,ignorePreDefinedFilter:!0},b),e=function(a){!a.selected||a.not4Counting&&c.ignorePreDefinedFilter||(a.selected=!1)};for(var f in a.filters)a.filters.hasOwnProperty(f)&&Array.isArray(a.filters[f])?a.filters[f].forEach(e):a.filters.hasOwnProperty(f)&&angular.isString(a.filters[f])&&delete a.filters[f];dc&&dc.filterAll&&dc.filterAll(),a.$broadcast("gridtable.reset"),a.$broadcast("optnpanel.reset"),c.doSearch&&a.onFilterChange&&d(function(){a.onFilterChange()})},a.resetAllSelection=a.resetAllSelection||function(){a.$parent.$broadcast("gridtable.resetAllSelection")};var h=function(){if(!a.config||!a.config.stringFilterFields)return null;var b=function(a){a.suggestions&&angular.isString(a.suggestions)?a.getSuggestions=function(){return e.getAutoSuggestion(a.suggestions)}():angular.isArray(a.suggestions)?a.getSuggestions=function(){return a.suggestions}:angular.isFunction(a.suggestions)&&(a.getSuggestions=a.suggestions)};if(angular.isObject(a.config.stringFilterFields))for(var c in a.config.stringFilterFields)a.config.stringFilterFields.hasOwnProperty(c)&&b(a.config.stringFilterFields[c]);else angular.isArray(a.config.stringFilterFields)&&a.config.stringFilterFields.forEach(function(a){b(a)})};h()};return b.$inject=["$scope","$http","BackendDriver","$timeout"],{templateUrl:"ddviews/advanced-options.html",restrict:"AE",replace:!0,transclude:!0,scope:{query:"=?",config:"=?",filters:"=",rangeFilters:"=?",selarrrow:"=?",onFilterChange:"&",resetAllSelection:"&"},link:a,controller:b}}),angular.module("ngramApp").directive("searchbar",function(){var a=function(a){a.query=a.query||{matching:""},a.placeholder=a.placeholder||"what are you looking for ...",a.hasValidInput=a.hasValidInput||function(b){return a.query&&a.query.matching&&a.query.matching.length>0}};return a.$inject=["$scope"],{templateUrl:"ddviews/searchbar.html",restrict:"AE",scope:{query:"=?",filters:"=?",onSearch:"&",onStartOver:"&",placeholder:"=?"},controller:a}}),angular.module("ngramApp").directive("checkboxInline",["$filter",function(a){var b=function(a){a.zerosFilter=function(b){return a.allowZeros||b.count>0||b.selected},a.limit=a.limitByNumber||10};return b.$inject=["$scope"],{templateUrl:"ddviews/checkboxInline.html",restrict:"AE",scope:{filters:"=",allowZeros:"=",limitByNumber:"=?",limitFilters:"=?",onFilterChanges:"&"},controller:b}}]),angular.module("ngramApp").directive("advancedOptionsSelectedButton",function(){return{templateUrl:"ddviews/advanced-options-selected-button.html",restrict:"AE",scope:{advOpts:"=",selarrrow:"=?",resetAllSelection:"&"}}}),angular.module("ngramApp").directive("barchart",function(){return{templateUrl:"ddviews/barchart.html",restrict:"AE",scope:{config:"=?",filters:"=?",rangeFilters:"=?",onFilterChanges:"&"},controller:["$scope","ngramAppConfig","$timeout",function(a,b,c){a.config=a.config||{field:"mw",name:"Molecular Weight",unit:"Molecular Weight, Daltons ",xmin:1,xmax:20,xtickscale:100,width:.5*window.innerWidth>500?500:.5*window.innerWidth,resizeWidth:function(){return.5*window.innerWidth>500?500:.5*window.innerWidth},height:100},a.rangeFilters=a.rangeFilters||[];var d=b.SINGULAR;if(d){var e;c(function(){e=a.config.xmax&&angular.isDate(a.config.xmax)?d.createTimeSeriesBarChart(a.config):d.createBarChart(a.config),e.margins(a.config.margins||{top:10,right:50,bottom:20,left:80}),e.filterHandler(function(){var b=d.getAllFilters();a.rangeFilters=b[a.config.field]&&angular.isArray(b[a.config.field])&&b[a.config.field].length>0?b[a.config.field][0]:[],c(function(){a.onFilterChanges()})}),e.load([]),window.addEventListener("resize",function(){a.config.resizeWidth&&angular.isFunction(a.config.resizeWidth)&&e.width(a.config.resizeWidth()).render(),dc.redrawAll()}),a.resetChart=function(a){e.filterAll(),dc.redrawAll()},a.$watch(function(a){return a.filters},function(b){var c=[];b&&angular.isArray(b)&&(c=!a.config.xtickscale||a.config.xmax&&angular.isDate(a.config.xmax)?b.map(function(a){return{key:a.name,value:a.count}}):b.map(function(b){return{key:b.name/(a.config.xtickscale||1),value:b.count}})),e.load(c)})})}}]}}),angular.module("ngramApp").directive("rowchart",function(){return{templateUrl:"ddviews/rowchart.html",restrict:"AE",scope:{config:"=?",filters:"=?",allowZeros:"=",limitByNumber:"=?",onFilterChanges:"&"},controller:["$scope","ngramAppConfig","$timeout",function(a,b,c){a.config=angular.extend({},{name:"test",label:"label",width:.5*window.innerWidth>500?500:.5*window.innerWidth,height:200,resizeWidth:function(){return.5*window.innerWidth>500?500:.5*window.innerWidth}},a.config),a.config.field=a.config.field||a.config.name;var d=b.SINGULAR;if(d){var e;c(function(){e=d.createRowChart(a.config),e.margins(a.config.margins||{top:5,right:5,bottom:20,left:8}),a.config&&a.config.colorAccessor&&e.colorAccessor(a.config.colorAccessor),e.filterHandler(function(){var b=d.getAllFilters(),e=b[a.config.field||a.config.name],f=a.filters.slice();e?f.forEach(function(a){e.indexOf(a.name)>-1?a.selected=!0:a.selected=!1}):f.forEach(function(a){a.selected=!1}),c(function(){a.filters=f,a.onFilterChanges()})}),e.load([]),window.addEventListener("resize",function(){a.config.resizeWidth&&angular.isFunction(a.config.resizeWidth)&&e.width(a.config.resizeWidth()).render(),dc.redrawAll()}),a.resetChart=function(b){a.filters.forEach(function(a){a.selected=!1}),e.filterAll(),dc.redrawAll()}}),a.$watch(function(a){return a.filters},function(b,c){var d=[];b&&angular.isArray(b)&&(d=b.slice(),a.allowZeros||(d=d.filter(function(a){return a.count>0})),a.limitByNumber&&(d=d.slice(0,a.limitByNumber)),d=d.map(function(a){return{key:a.name,value:a.count}})),e&&d&&e.load(d)},!0)}}]}}),angular.module("ngramApp").directive("searchbox",function(){var a=function(a){a.query=a.query||{matching:""},a.hasValidInput=a.hasValidInput||function(b){return a.query&&a.query.matching&&a.query.matching.length>0}};return a.$inject=["$scope"],{templateUrl:"ddviews/searchbox.html",restrict:"AE",scope:{query:"=?",filters:"=?",onSearch:"&",onStartOver:"&"},controller:a}}),angular.module("ngramApp").directive("gridTable",["ngramAppConfig","BackendDriver","$stateParams","$state","$compile","$timeout","$rootScope","$uibModal","trackEvent",function(a,b,c,d,e,f,g,h,i){var j=function(){$(".ui-jqgrid-hdiv .ui-jqgrid-htable th").attr("scope","col"),$(".ui-jqgrid-hdiv .ui-jqgrid-htable th.jqgh_rn .s-ico").attr("style",null).text("#"),$(".ui-jqgrid-hdiv .ui-jqgrid-htable th.jqgh_subgrid .s-ico").attr("style",null).text("."),$(".ui-widget-content .ui-pg-selbox").attr("aria-label","Records per Page").attr("title",null),$(".ui-jqgrid-bdiv .ui-jqgrid-btable td.jqgrid-rownum").attr("title",null),$(".ui-jqgrid-bdiv td[role=gridcell] input.cbox").attr("aria-label","select a record"),$(".ui-jqgrid-hdiv .ui-jqgrid-htable th.jqgh_cbox input.cbox").attr("aria-label","select/deselect all records"),$(".ui-jqgrid-hdiv .ui-jqgrid-htable th.jqgh_cbox .s-ico").text("#"),$('.ui-jqgrid-hbox > table[role="presentation"]').attr("role",null),$(".dd-autosuggest-input > input").attr("aria-expanded",null)},k=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},l=function(c,d){this._gridDefaultOptions=function(){return{datatype:"local",iconSet:"fontAwesome",prmNames:{nd:null},gridComplete:function(){j(),$(".jqgrid-ng-scope").each(function(){var a=$(this),b=angular.element(a).scope();e(a)(b)});var a=$(this).closest("grid-table");a.find(".ui-pg-button").each(function(){var a=$(this);!a.attr("aria-label")&&a.attr("title")&&a.attr("aria-label",a.attr("title")),a.hasClass("ui-state-disabled")?a.attr("aria-disabled",!0):a.removeAttr("aria-disabled")}),a.find(".ui-pg-input").attr("aria-label","Page number")},beforeSelectRow:function(a,b){var c=$(this),d=$.jgrid.getCellIndex($(b.target).closest("td")[0]),e=c.jqGrid("getGridParam","colModel");return"cb"===e[d].name},pager:c.pagerID,shrinkToFit:!0,forceFit:!0,viewrecords:!0,hoverrows:!1,width:"auto",height:"auto",minHeight:168,rowNum:10,rowList:[10,20,30],headertitles:!1,sortable:!0,cmTemplate:{title:!1},onSelectAll:function(a,b){var c=$(this).jqGrid("getGridParam","selarrrow");f(function(){d.selarrrow=c}),d.$emit("gridtable.allRowsOnPageBeingSelected",c,a,b)},onSelectRow:function(a,b){var c=$(this).jqGrid("getGridParam","selarrrow");f(function(){d.selarrrow=c}),d.$emit("gridtable.oneRowBeingSelected",c,a,b)},onSortCol:function(b,c,d){if(a.trackingEnabled){var e=$(this).jqGrid("getGridParam","colNames")[c]||"NONE";i("Column Sort",e,d,{jsevent:"dd_columnsort",columnname:e,direction:d})}},onPaging:function(b,c){a.trackingEnabled&&i("dd_pagination",b,c.currentPage||"NONE",{jsevent:"dd_pagination",button:b,current_page:c.currentPage||"",last_page:c.lastPage||""})}}},this._gridDefaultOptions_ByDataDicer=function(){return{hideLastPager:!0,adjustGridWidthOnWindowsResize:!0,adjustGridWidthOnColumnChange:!1,adjustGridWidthOnInit:!0,showHideColumns:!1,groupHeaders:!1}};var k=function(){var a=b.getDriver(c,d);return{url:a.url,jsonReader:a.jsonReader,postData:a.postData,beforeRequest:function(){var a=c.getPostData();for(var b in a)if(a.hasOwnProperty(b)&&/_array$/.test(b)&&angular.isFunction(a[b])){var d=null;try{var e=JSON.parse(a[b]());d=b.replace("_array",""),!angular.isArray(e)||e.length<=0?c.setPostData(d,[]):c.setPostData(d,e)}catch(f){c.setPostData(d,[])}finally{return!0}}},loadComplete:function(b){if(j(),d.userData=c.jqGrid("getGridParam","userData"),c.configurations.subGridExpanded){var e=c.getDataIDs();$.each(e,function(a,b){c.expandSubGridRow(b)})}a.updateFacets(b);var g=!1,h={status:d.userData&&d.userData.msg&&!d.userData.msg.success,msg:c.configurations.no_hits_message||"No hits found. Would you like to refine your query?"},i=c.jqGrid("getGridParam","records"),k=c.jqGrid("getGridParam","datatype");/local/.test(k)?g=!1:i<=0&&(g=!0),f(function(){return d.gridtable_show_error_message=g,d.totalNumberOfRecords=i,d.grid_search_backend_error=h,!!(g||i<=0)||(c.configurations.adjustGridWidthOnWindowsResize&&c.adjustGridWidth(),c.configurations.hideLastPager&&($("#last_pager"+d.uniqueId).addClass("ui-state-disabled").hide(),$("#last_t_grid"+d.uniqueId+"_toppager").addClass("ui-state-disabled").hide()),void d.$emit("gridtable.ensureRowsSelected",d.selarrrow))})}}};this._applyTransformation4LocalData=function(){var a=this;if(a.data){if(angular.isDefined(a.data)&&angular.isString(a.data))try{a.data=JSON.parse(a.data)}catch(b){a.data=[]}}else angular.extend(a,k());return a},this._portDisplayOptions=function(){if(this.displayOptions){var a={};angular.copy(this.displayOptions,a),delete this.displayOptions,angular.extend(this,a)}return this.fields&&angular.isArray(this.fields)&&(this.colModel=this.fields.slice(0),delete this.fields),this},this._suportSubGridRowExpandedCallback=function(){var a=this;return a.subGridRowExpanded?a:(a.subGridRowExpandedConfigCallback&&angular.isFunction(a.subGridRowExpandedConfigCallback)&&(a.subGridRowExpanded=function(b,d){var f=c.jqGrid("getRowData",d),i=b.split(".").join("\\."),j=$("#"+i);j.html('<div><span ng-click="open()" class="accessible-subgrid-title" ng-class="{visuallyhidden:config.accessibleTitleScreenReaderOnly}" >{{config.accessibleTitle | unsafe}}</span></div><div class="subgridtablediv" aria-hidden="true" role="presentation"><h5>{{config.title}}</h5> <grid-table query=query filters=filters config=config></grid-table></div>');var k=g.$new();k.config=a.subGridRowExpandedConfigCallback?a.subGridRowExpandedConfigCallback(i,d,f):null,k.query=a.subGridRowExpandedQueryCallback?a.subGridRowExpandedQueryCallback(i,d,f):null,k.open=function(){var a=h.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"ddviews/subgrid-modal.html",controller:["$scope","$uibModalInstance",function(a,b){a.config=k.config,a.filters=k.filters,a.query=k.query,a.ok=function(){b.close()}}],size:"large"});a.result.then(function(){},function(){})},e(j)(k)}),a)},this._applyTransformations=function(){return angular.extend(this,this._gridDefaultOptions(),this._gridDefaultOptions_ByDataDicer(),d.config),this._portDisplayOptions()._suportSubGridRowExpandedCallback()._applyTransformation4LocalData()},this._applyTransformations()},m=function(a,b,c,d){a.uniqueId=k(),a.$on("gridtable.reload",function(b,c){a.gridtable_show_error_message=!1,a.totalNumberOfRecords=1,a.grid_search_backend_error=!1,f(function(){a.reloadGrid&&a.reloadGrid(c)})}),a.$on("gridtable.expandSubgrid",function(b,c){var d=a.gridObject.getDataIDs();$.each(d,function(b,c){a.gridObject.expandSubGridRow(c)})}),a.$on("gridtable.collapseSubgrid",function(b,c){var d=a.gridObject.getDataIDs();$.each(d,function(b,c){a.gridObject.collapseSubGridRow(c)})}),a.$on("gridtable.resetAllSelection",function(b){a.gridObject.resetAllSelection(),f(function(){a.selarrrow=[]})}),a.$on("gridtable.selectRow",function(b,c){try{c.forEach(function(b){a.gridObject.setSelection(b,!1),a.selarrrow.indexOf(b)<=-1&&a.selarrrow.push(b)})}catch(b){console.warn(b)}}),a.$on("gridtable.ensureRowsSelected",function(b,c){try{c.forEach(function(b){var c=$('[id="'+b+'"]');c.hasClass("ui-state-highlight")||(a.gridObject.setSelection(b,!1),a.selarrrow.indexOf(b)<=-1&&a.selarrrow.push(b))})}catch(b){console.warn(b)}}),a.$on("gridtable.reset",function(){a.gridtable_show_error_message=!1,a.totalNumberOfRecords=0,a.grid_search_backend_error=!1}),$(b).on("keypress",'.ui-jqgrid .ui-pager-control *[role="button"]',function(a){" "===a.key&&($(this).click(),a.preventDefault())})},n=function(a,b,c){a.config=a.config||{autoLoad:!1,colModel:null,facetFields:null},a.query=a.query||{matching:""},a.filters=a.filters||{},a.rangeFilters=a.rangeFilters||{},a.renderGrid=function(){var a=a||this,c=$("#grid"+a.uniqueId);return c.pagerID="#pager"+a.uniqueId,c.getPostData=function(a){var b=c.jqGrid("getGridParam","postData");return a?b[a]:b},c.setPostData=function(a,b){if(a){var d=c.getPostData();d[a]=b,c.jqGrid("setGridParam",{postData:d})}},c.adjustGridWidth=function(){var a=c.closest(".ui-jqgrid").parent().width();c.jqGrid("setGridWidth",a,!0)},c.handleColumnHeaderToolTips=function(a,d){a=a?a.slice(0):[],d=d?d.slice(0):[];var e=function(a,c){a.attr("uib-tooltip-html","'"+c+"'"),a.attr("tooltip-append-to-body",!0),b(a)(angular.element(a).scope())},f=function(a){var b=0,c={},e=function(){return function(b){return b.titleText&&b.titleText===a}};if(d&&angular.isArray(d))for(b=0;b<d.length;b++)if(d[b].groupHeaders&&angular.isArray(d[b].groupHeaders)&&(c=d[b].groupHeaders.filter(e()),c&&c.length>0))return c[0];return c};if(c&&c[0]&&c[0].hasOwnProperty("grid")){var g=jQuery("thead:first",c[0].grid.hDiv)[0];$("tr.ui-jqgrid-labels th div",g).each(function(){var b=$(this).text(),c=a.filter(function(a){return a.label===b});c&&angular.isArray(c)&&c.length>0&&e($(this),c[0].tips||c[0].name)}),$("tr.ui-jqgrid-labels th:not(:has(div))",g).each(function(){var a=$(this).text(),b=f(a);e($(this),b.tips||b.titleText)})}},c.getDisplayColumns=function(){var a=c.getGridParam("colModel"),b=[];return $.each(a,function(a){this.hidden!==!0&&"rn"!==this.name&&"cb"!==this.name&&b.push(this.name)}),b},c.getAllColumns=function(){var a=c.getGridParam("colModel"),b=[];return $.each(a,function(a){"rn"!==this.name&&"cb"!==this.name&&b.push(this.name)}),b},c.configurations=new l(c,a),a.selarrrow=c.configurations.selarrrow&&angular.isArray(c.configurations.selarrrow)?c.configurations.selarrrow.slice(0):[],c.GridUnload(),c.jqGrid(c.configurations),c.jqGrid("navGrid",c.pagerID,angular.extend({edit:!1,add:!1,del:!1,search:!1,cloneToTop:!0},c.configurations.pagerConfig)),c.configurations.showHideColumns&&(c.jqGrid("showHideColumnMenu",{adjustGridWidth:c.configurations.adjustGridWidthOnColumnChange}),c.jqGrid("navButtonAdd",{caption:"Choose Columns",buttonicon:"ui-icon ui-icon-newwin",onClickButton:function(b){c.jqGrid("columnChooser",{width:600,dialog_opts:{modal:!0,minWidth:400,minHeight:400,show:"blind",hide:"blind",position:{my:"center top",at:"center top"}},done:function(b){if(!c.configurations.adjustGridWidthOnColumnChange){c.handleColumnHeaderToolTips(c.configurations.colModel,c.configurations.groupHeaders),c.trigger("resize");var d=c.getDisplayColumns();d&&d.length<=0&&c.trigger("reloadGrid")}b&&(c.jqGrid("remapColumns",b,!0),a.$emit("gridtable.columnUpdated",c))}})},title:"Columns",cursor:"pointer"})),c.configurations.adjustGridWidthOnInit&&c.adjustGridWidth(),c.parents("div.ui-jqgrid-bdiv").css("min-height",c.configurations.minHeight||"168px"),c.configurations.adjustGridWidthOnWindowsResize&&$(window).on("resize",function(){c.adjustGridWidth()}),c.configurations.groupHeaders&&angular.isArray(c.configurations.groupHeaders)&&c.configurations.groupHeaders.forEach(function(a){c.jqGrid("setGroupHeaders",a)}),c.handleColumnHeaderToolTips(c.configurations.colModel,c.configurations.groupHeaders),a.reloadGrid=function(b){a.config.data||c.jqGrid("setGridParam",angular.extend({search:!1,datatype:a.config.mtype&&/^POST/i.test(a.config.mtype)?"json":"jsonp"},b)).trigger("reloadGrid",[{page:1,current:!0}])},c},c(function(){a.gridObject=a.renderGrid(),a.gridObject.configurations.autoLoad?a.reloadGrid():a.$emit("gridtable.initialized")}),a.$watch(function(){var b=angular.copy(a.config);return delete b.advOpts,b},function(b){a.renderGrid(),a.reloadGrid()},!0)};return n.$inject=["$scope","$compile","$timeout"],{templateUrl:"ddviews/gridTable.html",transclude:!0,restrict:"E",scope:{query:"=?",config:"=?",filters:"=?",rangeFilters:"=?",selarrrow:"=?",gridObject:"=?"},link:m,controller:n}}]),angular.module("ngramApp").directive("popoverLinkMenu",["$compile","$sce",function(a,b){return{templateUrl:"ddviews/popoverlinkmenu.html",restrict:"E",replace:!0,scope:{tooltipTitleClass:"=?",tooltipTitle:"=?",linkData:"=?"},link:function(b,c){a(c.contents())(b)},controller:["$scope",function(a){a.tooltipTitle=a.tooltipTitle||"Links",a.linkData=a.linkData||[],angular.isString(a.linkData)&&(a.linkData=JSON.parse(a.linkData));var c="";a.linkData.forEach(function(a){c+='<li class="list-group-item"> <a target="_blank" href="'+a.url+'">'+a.name+"</a> </li>"}),a.htmlTips=b.trustAsHtml('<ul class="list-group">'+c+"</ul>")}]}}]),angular.module("ngramApp").directive("ddAutosuggestInput",function(){var a=function(a,b,c,d){a.$on("autosuggest-input.reset",function(b,c){a.myForm={_term:""}})},b=function(a,b){a.config=a.config||{},a.config.minimum=a.config.minimum||2,a.filters=a.filters||{},a.myForm={},a.$watch(function(a){return a.filters},function(b){b&&b.length>0?a.onFilterChanges():b&&""!==b||(a.myForm._term="")}),a.getSuggestedName=function(b){return a.getSuggestions({value:b})}};return b.$inject=["$scope","$http"],{templateUrl:"ddviews/dd-autosuggest-input.html",restrict:"AE",replace:!1,scope:{config:"=?",filters:"=?",getSuggestions:"&",onFilterChanges:"&"},link:a,controller:b}}),angular.module("ngramApp").directive("filterAsTab",function(){var a=function(a){a.mylimit=a.limit||6,a.tabChange=function(b){Array.isArray(a.filter)&&a.filter.forEach(function(a){a.selected=a.name===b.name,a.not4Counting=!0}),a.onFilterChange()}};return a.$inject=["$scope"],{templateUrl:"ddviews/filter-as-tab.html",restrict:"AE",scope:{filter:"=?",limit:"=?",onFilterChange:"&"},controller:a}}),angular.module("ngramApp").constant("ngramAppConfig",{serviceEngine:"ngram",serviceQueryUrl:"//ngram_server/ngram?&callback=?",serviceDownloadCallback:function(a){console.warn("serviceDownloadCallback is required, parameters are: ",a)},SINGULAR:"undefined"!=typeof Singular?new Singular:null}),angular.module("ngramApp").service("searchState",["$rootScope",function(a){var b={model:{},SaveState:function(){sessionStorage.userService=angular.toJson(b.model)},RestoreState:function(){b.model=angular.fromJson(sessionStorage.userService)},initState:function(){b.model={query:{sequence:""},filters:{tags:[]}}}};return b.initState(),a.$on("savestate",b.SaveState),a.$on("restorestate",b.RestoreState),sessionStorage.userService&&b.RestoreState(),b}]),angular.module("ngramApp").factory("debounce",["$timeout","$q",function(a,b){return function(c,d,e){var f,g=b.defer();return function(){var h=this,i=arguments,j=function(){f=null,e||(g.resolve(c.apply(h,i)),g=b.defer())},k=e&&!f;return f&&a.cancel(f),f=a(j,d),k&&(g.resolve(c.apply(h,i)),g=b.defer()),g.promise}}}]),angular.module("ngramApp").service("BackendDriver",["ngramAppConfig","$http",function(a,b){function c(a,b){var c=a.name&&angular.isString(a.name)?a.name.toLowerCase():a.name,d=b.name&&angular.isString(b.name)?b.name.toLowerCase():b.name;return c<d?-1:c>d?1:0}var d=this;d.backendDriver=void 0,d.serviceEngine=a.serviceEngine,d.serviceUidFieldName=a.serviceUidFieldName||"id",d.serviceQueryUrl=a.serviceQueryUrl,d.serviceDownloadCallback=a.serviceDownloadCallback,d.getDriver=function(a,b){return d.serviceEngine=b.config.serviceEngine||d.serviceEngine,d.serviceUidFieldName=b.config.serviceUidFieldName||d.serviceUidFieldName,d.serviceQueryUrl=b.config.serviceQueryUrl||d.serviceQueryUrl,d.serviceDownloadCallback=b.config.serviceDownloadCallback||d.serviceDownloadCallback,"ngram"===d.serviceEngine?d.backendDriver=d.ngram(a,b):"solr"===d.serviceEngine?d.backendDriver=d.solr(a,b):"seqr"===d.serviceEngine?d.backendDriver=d.solr(a,b,!0):console.warn("invalid/unsupported backend ENGINE : "+d.serviceEngine),
d.backendDriver},d.solr=function(a,e,f){jQuery&&jQuery.ajaxSettings&&(jQuery.ajaxSettings.traditional=!0),e._solrFacetsInfo=e._solrFacetsInfo||{};var g=function(a,b){if(!b)return console.error("field name is required for facets updating!"),!1;var d,f={},g=null,h=a&&a.facet_counts&&a.facet_counts.facet_fields&&a.facet_counts.facet_fields[b]?a.facet_counts.facet_fields[b]:[];h.length<1&&(h=a&&a.facet_counts&&a.facet_counts.facet_ranges&&a.facet_counts.facet_ranges[b]&&a.facet_counts.facet_ranges[b].counts?a.facet_counts.facet_ranges[b].counts:[],g=a&&a.facet_counts&&a.facet_counts.facet_ranges&&a.facet_counts.facet_ranges[b]&&a.facet_counts.facet_ranges[b].gap?a.facet_counts.facet_ranges[b].gap:null);var i=a&&a.responseHeader&&a.responseHeader.params&&a.responseHeader.params["f."+b+".facet.scale"]?a.responseHeader.params["f."+b+".facet.scale"]:null;for(e&&g&&i?(e._solrFacetsInfo[b]=e._solrFacetsInfo[b]||{},e._solrFacetsInfo[b].facetGap=g,e._solrFacetsInfo[b].facetScale=i):delete e._solrFacetsInfo[b],d=0;d<h.length;d+=2)g&&i&&(h[d]=Math.floor(parseFloat(h[d]))/i),f[h[d]]=h[d+1];var j=e.filters[b]&&angular.isArray(e.filters[b])?e.filters[b].slice(0):[];for(d=0;d<j.length;d++)j[d].count=f[j[d].name]||0,delete f[j[d].name];for(d in f)f.hasOwnProperty(d)&&j.push({name:d,count:f[d]});g||j.sort(c),e.filters[b]=j},h=function(a){if(a&&a.facet_counts&&a.facet_counts.facet_fields){var b;for(b in a.facet_counts.facet_fields)a.facet_counts.facet_fields.hasOwnProperty(b)&&g(a,b);for(b in a.facet_counts.facet_ranges)a.facet_counts.facet_ranges.hasOwnProperty(b)&&g(a,b)}},i=function(a){function b(b){if(a[b])return!0;var d=f?b:"{!tag="+b+"}"+b;if(e.filters[b]&&angular.isArray(e.filters[b])&&e.filters[b].length>0){var g=[];e.filters[b].forEach(function(a){a.selected&&g.push('"'+a.name+'"')}),g.length>0&&c.push(d+":("+g.join(" OR ")+")")}else e.filters[b]&&angular.isString(e.filters[b])&&e.filters[b].length>0&&c.push(d+':"'+e.filters[b]+'"');if(e.rangeFilters[b]&&angular.isArray(e.rangeFilters[b])&&2===e.rangeFilters[b].length){var h=e.rangeFilters[b].slice(0);e._solrFacetsInfo[b]&&e._solrFacetsInfo[b].facetScale&&(h=h.map(function(a){return a*e._solrFacetsInfo[b].facetScale})),c.push(d+":["+h.join(" ")+"]")}}var c=[];a=a||{};for(var d in e.filters)!a[d]&&e.filters.hasOwnProperty(d)&&b(d);return c},j=angular.extend({},{q:function(){var a="*:*";return e.query&&e.query.matching&&e.query.matching.length>0&&(a=f?e.query.matching:encodeURIComponent(e.query.matching)),a},start:function(){var b=(a.jqGrid("getGridParam","page")-1)*a.jqGrid("getGridParam","rowNum");return b},fq_array:function(){var a=i();return JSON.stringify(a)},sort:function(){var b=a.getPostData();return b.sidx&&""!==b.sidx?b.sidx+" "+b.sord:""}},e.config.SolrBackEndConfigurations),k=function(a){var b=j.q();e.selarrrow&&angular.isArray(e.selarrrow)&&e.selarrrow.length>0&&(b=e.selarrrow.join(" "));var c=i(a);return{q:b,filters:c}},l=function(a,b,c){b=b||"blastname",c=c||"facet_fields";var d={},e=[];try{e=a&&a.facet_counts&&a.facet_counts.hasOwnProperty(c)&&a.facet_counts[c].hasOwnProperty(b)?a.facet_counts[c][b]:[];for(var f=0;f<e.length;f+=2)d[e[f]]=e[f+1]}catch(g){}finally{return d}},m=function(a){return function(c){var e=i(),f=j.q(),g=d.serviceQueryUrl;return g=g.replace(/callback=\?/,""),g=g.replace(/json\.wrf=\?/,""),e.forEach(function(a){g+="&fq="+a}),b.jsonp(g,{params:{q:f?f:"*:*",rows:0,"json.wrf":"JSON_CALLBACK",facet:"on","facet.prefix":c||"","facet.limit":10,"facet.mincount":1,"facet.field":"{!ex="+a+"}"+a},cache:!0}).then(function(b){return l(b.data,a)}).then(function(a){return Object.keys(a||{})})}};return{url:d.serviceQueryUrl,jsonReader:{repeatitems:!1,id:d.serviceUidFieldName,root:function(a){return a&&a.response&&a.response.docs?a.response.docs:null},page:function(b){return Math.floor((b&&b.response&&b.response.start?b.response.start:0)/a.jqGrid("getGridParam","rowNum"))+1},total:function(b){try{var c=b&&b.response&&b.response.numFound?b.response.numFound:0;return Math.ceil(c/a.jqGrid("getGridParam","rowNum"))}catch(d){return 0}},records:function(a){return a&&a.response&&a.response.numFound?a.response.numFound:0},userdata:function(a){return{maxScore:a&&a.response&&a.response.maxScore?a.response.maxScore:0,docs:a&&a.response&&a.response.docs?a.response.docs:[],msg:a,maps:function(){var b={};return a.response&&a.response.docs&&a.response.docs.forEach(function(a){a._id&&(b[a._id]=a)}),b}()}}},postData:j,updateFacets:h,getAutoSuggestion:m,download:function(){d.serviceDownloadCallback&&angular.isFunction(d.serviceDownloadCallback)?d.serviceDownloadCallback(k()):console.warn("config.serviceDownloadCallback not provided for solr Engine!")}}},d.ngram=function(a,e){var f=function(a){var b=function(a){var b={};if(!angular.isArray(a))return b;for(var c=0;c<a.length;c++)a[c].name&&(b[a[c].name]=a[c]);return b};if(a&&a.ngout&&a.ngout.hist)for(var d in a.ngout.hist)if(a.ngout.hist.hasOwnProperty(d)&&a.ngout.hist[d]&&a.ngout.hist[d].values){for(var f=b(a.ngout.hist[d].values),g=e.filters[d]?e.filters[d].slice(0):[],h=0;h<g.length;h++)g[h].count=f[g[h].name]&&f[g[h].name].count?f[g[h].name].count:0,delete f[g[h].name];for(var i in f)f.hasOwnProperty(i)&&g.push(f[i]);e.filters[d]=g.sort(c)}},g=function(a){function b(b){if(a[b])return!0;if(e.filters[b]&&angular.isArray(e.filters[b])&&e.filters[b].length>0){var d=[];e.filters[b].forEach(function(a){a.selected&&d.push('"'+a.name+'"')}),d.length>0&&c.push(b+"==["+d.join(",")+"]")}else e.filters[b]&&angular.isString(e.filters[b])&&e.filters[b].length>0&&c.push(b+'=="'+e.filters[b]+'"');e.rangeFilters[b]&&angular.isArray(e.rangeFilters[b])&&2===e.rangeFilters[b].length&&(c.push(b+'>="'+e.rangeFilters[b][0]+'"'),c.push(b+'<="'+e.rangeFilters[b][1]+'"'))}var c=[];a=a||{};for(var d in e.filters)!a[d]&&e.filters.hasOwnProperty(d)&&b(d);return c},h={from:function(){return".from("+(e.config.NgramBackEndConfigurations.collection||e.config.collection)+").usingschema(/schema/"+(e.config.NgramBackEndConfigurations.schema||e.config.schema)+")"},matching:function(a,b){var c="",d=g(a);return b&&e.selarrrow&&angular.isArray(e.selarrrow)&&e.selarrrow.length>0?d.push('q=="'+encodeURIComponent(e.selarrrow.join(" "))+'"'):e.query&&e.query.matching&&e.query.matching.length>0?d.push('q=="'+encodeURIComponent(e.query.matching)+'"'):e.query||console.info("query parameter wasn't defined: possibility missing query=query in <advanced-options>"),d.length>0&&(c=".matching("+d.join(" and ")+")"),c},sort:function(){var b="";try{var c=a.getPostData();if(c.sidx&&c.sidx&&c.sord){var d=c.sidx.trim()+" "+c.sord.trim().toLowerCase();d=d.replace(/\s+/g,","),d=d.replace(/,+/g,","),b+=".sort("+d+")"}}catch(e){console.warn(e)}return b}},i=function(){var a=[],b=function(b){b&&b.field?a.push(b.field):b&&b.name&&a.push(b.name)};angular.isArray(e.config.facetFields)&&e.config.facetFields.forEach(b),angular.isArray(e.config.rangeFacetFields)&&e.config.rangeFacetFields.forEach(b);var c="[display()"+(a&&a.length>0?",hist("+a.join(",")+")":"")+"]";return c+=h.from(),c+=h.matching(),c+=h.sort()},j=function(a){return"[display()]"+h.from()+h.matching(null,!0)},k=function(a){return function(c){var e="autosuggest("+a+',"'+c+'")';return e+=h.from(),e+=h.matching(),b({url:d.serviceQueryUrl,method:"POST",data:{q:e}}).then(function(b){try{if(b.data.ngout.hist[a].values)return b.data.ngout.hist[a].values.map(function(a){return a.name||""})}catch(c){return[]}})}};return{url:d.serviceQueryUrl,jsonReader:{repeatitems:!1,id:d.serviceUidFieldName,root:function(a){return a&&a.ngout&&a.ngout.data&&a.ngout.data.content?a.ngout.data.content:[]},total:function(b){try{var c=b&&b.ngout&&b.ngout.data&&b.ngout.data.totalCount?b.ngout.data.totalCount:0;return Math.ceil(c/a.jqGrid("getGridParam","rowNum"))}catch(d){return 0}},records:function(a){return a&&a.ngout&&a.ngout.data&&a.ngout.data.totalCount?a.ngout.data.totalCount:0},userdata:function(a){function b(){var b={};return a&&a.ngout&&a.ngout.data&&a.ngout.data.content&&a.ngout.data.content.forEach(function(a){a._id&&(b[a._id]=a)}),b}return{docs:a&&a.ngout&&a.ngout.data&&a.ngout.data.content?a.ngout.data.content:[],msg:a,maps:b()}}},postData:{start:function(){return(a.jqGrid("getGridParam","page")-1)*a.jqGrid("getGridParam","rowNum")},limit:function(){return a.jqGrid("getGridParam","rowNum")},q:i},updateFacets:f,getAutoSuggestion:k,download:function(){var a={q:j()||"",limit:1e4,download:"csv"};d.serviceDownloadCallback&&angular.isFunction(d.serviceDownloadCallback)?d.serviceDownloadCallback(a):console.warn("config.serviceDownloadCallback not provided for ngram Engine!")}}}}]),angular.module("ngramApp").service("trackEvent",function(){return function(a,b,c,d){if(window.ncbi&&window.ncbi.sg&&(d||(d={jsevent:a,action:b,label:c}),window.ncbi.sg.ping&&window.ncbi.sg.ping(d),window.ncbi.sg.getGA)){var e=window.ncbi.sg.getGA();e&&e("send","event",a,b,c)}}}),angular.module("ngramApp").service("trackSearch",["trackEvent",function(a){return function(b,c){var d=c&&c.matching?c.matching:"";a("Search","ddsearchbar",d,{jsevent:"search",search_form_name:"ddsearchbar",ncbi_term:d})}}]),angular.module("ngramApp").service("trackClick",["trackEvent",function(a){return function(a,b){window.ncbi&&window.ncbi.sg&&(window.ncbi.sg.ping(a.target,a,"click",{dd_section:b}),window.ncbi.sg.getGA&&window.ncbi.sg.getGA()("send","event","Link Click",b,a.target.innerText||a.target.textContent||""))}}]);var DataDicer="undefined"!=typeof DataDicer?DataDicer:function(){return{version:"0.2.46",bootstrap:function(a,b){var c=b?document.getElementById(b):document.body,d=b+"App";angular.element(c).append('<div class="app" ng-app='+d+'><div ng-controller=gridController><div class="row"><div searchbox query="query" filters="filters" on-search="performSearchDebounced()" on-start-over="startOver()"></div></div><advanced-options config="gridConfig" filters="filters" range-filters="rangeFilters" on-filter-change="performSearchDebounced()"></advanced-options><grid-table query=query config=gridConfig filters="filters" range-filters="rangeFilters"></grid-table></div></div>'),angular.module(d,["ngramApp"]).controller("gridController",["$scope","debounce",function(b,c){b.query={matching:a.query},delete a.query,b.filters=b.filters||[],b.rangeFilters=b.rangeFilters||{},b.gridConfig=a,b.performSearchDebounced=c(function(a){b.$broadcast("gridtable.reload")},600,!1),b.startOver=function(a){b.query.matching="",b.filters.resetAllFilters(),b.performSearchDebounced()}}])}}};